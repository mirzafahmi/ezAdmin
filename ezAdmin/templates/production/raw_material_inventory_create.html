{% extends 'partials/base.html' %}
{% block tittle %} Add Raw Material Inventory{% endblock %}
{% load crispy_forms_tags %}

{% block content %}
    <div class="container">
        <div class="row mt-5">
            <div class="col-md-6 offset-md-3">
                <div class="border p-3">
                    {% for message in messages %}
                    {% if message %}
                    <div class = "alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                    {% endif %}
                    {% endfor %}
                    {% if form.initial.stock_type == '1' %}
                    <h3>Log-In Raw Material Inventory</h3>
                    {% endif %}
                    {% if form.initial.stock_type == '2' %}
                    <h3>Log-Out Raw Material Inventory</h3>
                    {% endif %}
                    <hr>
                    <form method="POST">
                        {% csrf_token %}
                        {{ form|crispy}}
                        <a class="btn btn-light"  href = ""> Cancel</a>
                        <input class="btn btn-success" type="submit" value="Create Inventory Log">
                    </form>
                </div>
            </div>
        </div>    
    </div>
    <!-- add logic to the stock out thus it can stock out more than stock in 
    <script>
        $(document).ready(function () {
            // Function to set the readonly state based on a flag
            function setReadonlyState(flag) {
                $('#id_lot_number').prop('readonly', flag);
                $('#id_exp_date').prop('readonly', flag);
                $('#id_price_per_unit').prop('readonly', flag);
                $('#id_purchasing_doc').prop('readonly', flag);
            }

            // Check the local storage for the readonly flag
            var readonlyFlag = localStorage.getItem('readonlyFlag');
        
            // If the flag is set, apply readonly state
            if (readonlyFlag === 'true') {
                setReadonlyState(true);
            }
        
            // Listen for changes in the component field
            $('#id_component').on('change', function () {
                var componentId = $(this).val();
                var type = $('#id_stock_type').val();  // Assuming stock_type has the ID id_stock_type

                // Make AJAX request to fetch FIFO information
                if (type === '2') {
                    $.ajax({
                        url: '',  // Replace with your actual endpoint
                        method: 'GET',
                        data: {
                            component_id: componentId,
                            type: type
                        },
                        dataType: 'json',
                        success: function (data) {
                            // Update form fields with retrieved information
                            $('#id_lot_number').val(data.lot_number);
                            $('#id_exp_date').val(data.exp_date);
                            $('#id_price_per_unit').val(data.price_per_unit);
                            $('#id_purchasing_doc').val(data.purchasing_doc);
        
                            // Set readonly state and store the flag in local storage
                            setReadonlyState(true);
                            localStorage.setItem('readonlyFlag', 'true');
                        },
                        error: function () {
                            console.log('Error fetching FIFO information.');
                        }
                    });
                } else {
                    // If the type is not '2', remove readonly attribute and clear the flag
                    setReadonlyState(false);
                    localStorage.removeItem('readonlyFlag');
                }
            });
        });        
    </script>
    -->
{% endblock %}